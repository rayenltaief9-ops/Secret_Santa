<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Secret Santa Jackpot üé∞</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #ff335f 0%, #ff8b00 100%);
    font-family: 'Poppins', sans-serif;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  .machine {
    width: 90%;
    max-width: 600px;
    background: #222;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
    text-align: center;
  }
  h1 {
    font-size: 2.2rem;
    margin-bottom: 4px;
    color: #ffdd57;
  }
  .sub {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 10px;
  }
  .slot {
    background: black;
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    font-size: 2.2rem;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #ffdd57;
    letter-spacing: 3px;
    font-weight: bold;
  }
  select, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
  }
  select {
    background: #111;
    color: white;
  }
  button {
    background: #ff335f;
    color: white;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
  }
  button:hover {
    background: #ff1133;
    transform: scale(1.05);
  }
  button:disabled {
    opacity: 0.6;
    cursor: default;
    transform: none;
  }
  .spin {
    animation: spin 0.5s infinite linear;
  }
  @keyframes spin {
    from { transform: rotateX(0); }
    to { transform: rotateX(360deg); }
  }
  .msg {
    font-size: 0.9rem;
    opacity: 0.9;
    min-height: 1.2em;
  }
</style>
</head>
<body>
<div class="machine">
  <h1>üé∞ Secret Santa Jackpot üéÅ</h1>
  <p class="sub">Each phone talks to the same Secret Santa brain. No one can spin twice. No chaos (ok, a little).</p>

  <select id="giver">
    <option value="">Pick your name‚Ä¶</option>
  </select>
  <button id="spinBtn">SPIN! üé≤</button>

  <div id="slot" class="slot">??</div>
  <p id="msg" class="msg"></p>
</div>

<script>
const people = ["alice","rayen","hannagh","martina","sasha","will","fabi","arian","ayumi"];

const giverSelect = document.getElementById("giver");
const slot = document.getElementById("slot");
const spinBtn = document.getElementById("spinBtn");
const msg = document.getElementById("msg");

// populate select
people.forEach(n => {
  const opt = document.createElement("option");
  opt.value = n;
  opt.textContent = n.charAt(0).toUpperCase() + n.slice(1);
  giverSelect.appendChild(opt);
});

function setMessage(text, emoji = "") {
  msg.textContent = emoji ? `${emoji} ${text}` : text;
}

async function spinJackpot() {
  const giver = giverSelect.value;
  if (!giver) {
    setMessage("Pick your own name first, mysterious stranger.", "‚ö†Ô∏è");
    return;
  }

  // start local animation
  slot.classList.add("spin");
  slot.style.color = "#ffdd57";
  slot.textContent = "SPINNING...";
  spinBtn.disabled = true;
  setMessage("Contacting North Pole servers‚Ä¶", "üéÑ");

  try {
    // call backend
    const res = await fetch(`/api/target?giver=${encodeURIComponent(giver)}`);
    const data = await res.json();

    slot.classList.remove("spin");

    if (!res.ok) {
      if (data.error === "already_played") {
        slot.textContent = "Already played üö´";
        slot.style.color = "#ff335f";
        setMessage("Nice try, you only get ONE Secret Santa.", "üß†");
      } else if (data.error === "unknown_giver") {
        slot.textContent = "Error";
        slot.style.color = "#ff335f";
        setMessage("Your name is not in the list, lil chaos gremlin.", "ü§®");
      } else {
        slot.textContent = "Error";
        slot.style.color = "#ff335f";
        setMessage("Something broke. Blame the reindeer.", "üí•");
      }
      return;
    }

    // success
    const target = data.target;
    // tiny delay for drama
    setTimeout(() => {
      slot.textContent = target.toUpperCase();
      slot.style.color = "#ffdd57";
      setMessage(`You are now emotionally responsible for ${target.charAt(0).toUpperCase() + target.slice(1)}'s happiness.`, "üéÅ");
    }, 500);

  } catch (e) {
    console.error(e);
    slot.classList.remove("spin");
    slot.textContent = "NO INTERNET";
    slot.style.color = "#ff335f";
    setMessage("Network error. Santa's Wi-Fi died.", "üì∂");
  } finally {
    setTimeout(() => {
      spinBtn.disabled = false;
    }, 800);
  }
}

spinBtn.addEventListener("click", spinJackpot);
</script>
</body>
</html>